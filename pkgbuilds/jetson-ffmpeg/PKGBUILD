pkgname=jetson-ffmpeg
pkgbase=jetson-ffmpeg
pkgver=R32
pkgrel=3.1
arch=('aarch64')
license=('GPL')
url="https://github.com/jocover/jetson-ffmpeg"
sha256sums=('SKIP')
makedepends=('git', 'cmake')
depends=('tegra-bsp', 'v4l-utils')

prepare() {
	git clone https://github.com/jocover/jetson-ffmpeg.git "${pkgbase}-${pkgver}"
	mkdir -p "${pkgbase}-${pkgver}"/build/
}

build() {
	cd "${pkgbase}-${pkgver}"/build
	cmake ..
	make -j$(nproc)
}

package() {
	cd "${pkgbase}-${pkgver}"/build
	mkdir -p ${pkgdir}/usr/{lib,include,share}/
	mkdir -p ${pkgdir}/usr/share/pkgconfig/
	install -m644 ${srcdir}/"${pkgbase}-${pkgver}"/build/libnvmpi.so.1.0.0 ${pkgdir}/usr/lib/
	install -m644 ${srcdir}/"${pkgbase}-${pkgver}"/build/libnvmpi.so ${pkgdir}/usr/lib/
	install -m644 ${srcdir}/"${pkgbase}-${pkgver}"/nvmpi.h ${pkgdir}/usr/include/
	install -m644 ${srcdir}/"${pkgbase}-${pkgver}"/build/nvmpi.pc ${pkgdir}/usr/share/pkgconfig/
}